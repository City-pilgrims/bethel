{% extends 'base.html' %}
{% load bootstrap4 %}
{% load static %}

{% block content %}

     <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- 현재 content 필드 -->
        <div style="width: 80%; height: 200px; border-color: gray; resize: vertical; margin: auto; margin-bottom: 2rem;">
            <label for="{{ form.content.id_for_label }}">게시글 내용</label>
            <!-- 여기서 form.content를 사용하여 Django가 자동으로 값을 렌더링하게 함 -->
            {{ form.content }}
        </div>

        <!-- 기존 이미지 표시 -->
        {% if form.instance.image %}
            <div id="current-image-container">
                <p>현재 이미지:</p>
                <img id="current-image" src="{{ form.instance.image.url }}" alt="현재 이미지"
                     style="max-width: 200px; height: auto; border-radius: 8px;">
            </div>
        {% endif %}

        <!-- 파일 업로드 필드 -->
        <div>
            <label for="{{ form.image.id_for_label }}">새로운 이미지 업로드:</label>
            {{ form.image }}
        </div>

        <!-- 새롭게 선택한 이미지 미리 보기 -->
        <div id="preview-container" style="display: none;">
            <p>새 이미지 미리 보기:</p>
            <img id="preview-image" src="#" alt="새 이미지 미리보기"
                 style="max-width: 200px; height: auto; border-radius: 8px;">
        </div>
        <br>
        <button type="submit" class="btn btn-success rounded-pill btn-sm col-3"
                style="text-decoration-line: none;">
            업데이트
        </button>
    </form>

    <br>
    <a href="{% url 'pilgrimsapp:pilboardlist' %}">게시글 목록보기</a>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const imageInput = document.querySelector("#id_image");
            const previewContainer = document.querySelector("#preview-container");
            const previewImage = document.querySelector("#preview-image");
            const currentImageContainer = document.querySelector("#current-image-container");

            imageInput.addEventListener("change", function () {
                const file = this.files[0];

                if (file) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                        previewContainer.style.display = "block";

                        // 기존 이미지 숨기기
                        if (currentImageContainer) {
                            currentImageContainer.style.display = "none";
                        }
                    };

                    reader.readAsDataURL(file);
                } else {
                    previewContainer.style.display = "none";

                    // 기존 이미지 다시 보이게 하기 (파일 선택 취소한 경우)
                    if (currentImageContainer) {
                        currentImageContainer.style.display = "block";
                    }
                }
            });
        });

    </script>

{% endblock %}